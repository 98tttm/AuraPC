<section class="qr-page">
  <div class="qr-container">
    <a routerLink="/checkout" class="qr-back">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
      Quay lại thanh toán
    </a>
    <app-checkout-stepper [step]="3"></app-checkout-stepper>

    <div class="qr-layout">
      <!-- ===== CỘT TRÁI: QR + thông tin ===== -->
      <div class="qr-left">
        <div class="qr-card">
          <h2 class="qr-section-title">Thanh toán bằng QR Code</h2>
          <p class="qr-hint">Mở app ngân hàng, quét mã bên dưới để chuyển khoản</p>

          <div class="qr-amount-block">
            <span class="qr-amount-label">Số tiền cần chuyển</span>
            <span class="qr-amount-value">{{ formatPrice(amount) }}</span>
          </div>

          @if (orderNumber) {
          <div class="qr-order-block">
            <span class="qr-order-label">Mã đơn hàng</span>
            <span class="qr-order-value">{{ orderNumber }}</span>
          </div>
          } @else {
          <p class="qr-order-note">Sau khi bấm «Tôi đã chuyển khoản», mã đơn hàng sẽ hiển thị ở trang kết quả.</p>
          }

          <div class="qr-code-wrap">
            <div class="qr-code-inner">
              <img src="assets/QR/qrbank.png" alt="Mã QR thanh toán ngân hàng" class="qr-code-img" width="280" height="280" />
              <span class="qr-scan-line" aria-hidden="true"></span>
            </div>
          </div>

          <p class="qr-content-label">Nội dung chuyển khoản (ghi đúng để đối soát)</p>
          <div class="qr-content-box">{{ qrContent() }}</div>
        </div>
      </div>

      <!-- ===== CỘT PHẢI: Ô tóm tắt đầy đủ như trang checkout ===== -->
      <div class="qr-right">
        <div class="qr-summary">
          <button type="button" class="qr-summary__coupon" disabled>
            <span class="qr-summary__coupon-text">Áp dụng ưu đãi để được giảm giá</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>

          <div class="summary-row">
            <span class="summary-label">Tổng tiền</span>
            <span class="summary-val">{{ formatPrice(originalTotal) }}</span>
          </div>
          <div class="summary-row">
            <span class="summary-label">Giảm giá trực tiếp</span>
            <span class="summary-val summary-val--discount">{{ directDiscountLabel() }}</span>
          </div>
          <div class="summary-row">
            <span class="summary-label">Phí vận chuyển</span>
            <span class="summary-val summary-val--free">Miễn phí</span>
          </div>

          <div class="summary-divider"></div>

          <div class="summary-row summary-row--total">
            <span class="summary-label">Thành tiền</span>
            <span class="summary-val summary-val--total">{{ formatPrice(amount) }}</span>
          </div>

          @if (confirmError) {
          <p class="qr-confirm-error" role="alert">{{ confirmError }}</p>
          }
          <button type="button" class="qr-summary__btn" (click)="onConfirmTransfer()" [disabled]="confirmSubmitting">
            {{ confirmSubmitting ? 'Đang tạo đơn...' : 'Tôi đã chuyển khoản' }}
          </button>

          <p class="qr-terms">
            Bằng việc bấm xác nhận, bạn đồng ý với <a href="#">Điều khoản dịch vụ</a> của AuraPC. Chúng tôi sẽ đối soát và xác nhận đơn hàng trong thời gian sớm nhất.
          </p>
        </div>
      </div>
    </div>
  </div>
</section>
