<section class="checkout-page">
    <div class="checkout-container">
        <!-- Header -->
        <a routerLink="/cart" class="checkout-back">‚Üê QUAY L·∫†I GI·ªé H√ÄNG</a>

        <div class="checkout-layout">
            <!-- Left Column -->
            <div class="checkout-left">
                <!-- Product List -->
                <div class="checkout-card">
                    <h2 class="checkout-section-title">Danh s√°ch s·∫£n ph·∫©m</h2>
                    @for (item of cartItems(); track item.product._id) {
                    <div class="checkout-product">
                        <div class="checkout-product__img">
                            <img [src]="getImage(item.product)" [alt]="item.product.name" />
                        </div>
                        <div class="checkout-product__info">
                            <h3 class="checkout-product__name">{{ item.product.name }}</h3>
                            <p class="checkout-product__price">{{ getPrice(item.product) | number:'1.0-0' }} ƒë</p>
                            <p class="checkout-product__qty">S·ªë l∆∞·ª£ng: {{ item.qty }}</p>
                        </div>
                        <button class="checkout-product__remove" (click)="removeItem(item.product._id!)">X√≥a</button>
                    </div>
                    <div class="checkout-promo-banner">
                        <span class="promo-icon">üéÅ</span>
                        Gi·∫£m ngay 20% √°p d·ª•ng ƒë·∫øn 31/01
                    </div>
                    }
                </div>

                <!-- Buyer Info -->
                <div class="checkout-card">
                    <h3 class="form-section-title">Th√¥ng tin ng∆∞·ªùi ƒë·∫∑t</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <input type="text" [(ngModel)]="fullName" placeholder="H·ªç v√† t√™n ng∆∞·ªùi ƒë·∫∑t" />
                        </div>
                        <div class="form-group">
                            <input type="tel" [(ngModel)]="phone" placeholder="S·ªë ƒëi·ªán tho·∫°i" />
                        </div>
                    </div>
                    <div class="form-group">
                        <input type="email" [(ngModel)]="email" placeholder="Email (kh√¥ng b·∫Øt bu·ªôc)" />
                    </div>

                    <h3 class="form-section-title">Th√¥ng tin nh·∫≠n h√†ng</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <input type="text" [(ngModel)]="receiverName" placeholder="H·ªç v√† t√™n ng∆∞·ªùi nh·∫≠n" />
                        </div>
                        <div class="form-group">
                            <input type="tel" [(ngModel)]="receiverPhone" placeholder="S·ªë ƒëi·ªán tho·∫°i" />
                        </div>
                    </div>

                    <h3 class="form-section-title">ƒê·ªãa ch·ªâ</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <select [(ngModel)]="city">
                                <option value="">Ch·ªçn T·ªânh/ Th√†nh ph·ªë</option>
                                <option value="hcm">TP. H·ªì Ch√≠ Minh</option>
                                <option value="hn">H√† N·ªôi</option>
                                <option value="dn">ƒê√† N·∫µng</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <select [(ngModel)]="district">
                                <option value="">Ch·ªçn Qu·∫≠n/ Huy·ªán</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <select [(ngModel)]="ward">
                            <option value="">Ch·ªçn Ph∆∞·ªùng/ X√£</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <input type="text" [(ngModel)]="address" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ c·ª• th·ªÉ" />
                    </div>
                    <div class="form-group">
                        <textarea [(ngModel)]="note" placeholder="Ghi ch√∫ (kh√¥ng b·∫Øt bu·ªôc)" rows="4"></textarea>
                    </div>

                    <div class="invoice-toggle">
                        <span class="invoice-label">Y√™u c·∫ßu xu·∫•t h√≥a ƒë∆°n ƒëi·ªán t·ª≠</span>
                        <label class="toggle-switch">
                            <input type="checkbox" [(ngModel)]="requestInvoice" />
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <!-- Payment Methods -->
                <div class="checkout-card">
                    <div class="payment-option" (click)="paymentMethod = 'cod'">
                        <span class="radio" [class.active]="paymentMethod === 'cod'"></span>
                        <span>Thanh to√°n ti·ªÅn m·∫∑t khi nh·∫≠n h√†ng</span>
                    </div>
                    <div class="payment-option" (click)="paymentMethod = 'momo'">
                        <span class="radio" [class.active]="paymentMethod === 'momo'"></span>
                        <span>Thanh to√°n b·∫±ng v√≠ MoMo</span>
                    </div>
                    <div class="payment-option" (click)="paymentMethod = 'atm'">
                        <span class="radio" [class.active]="paymentMethod === 'atm'"></span>
                        <span>Thanh to√°n b·∫±ng th·∫ª ATM n·ªôi ƒë·ªãa</span>
                    </div>
                    <div class="payment-option" (click)="paymentMethod = 'zalopay'">
                        <span class="radio" [class.active]="paymentMethod === 'zalopay'"></span>
                        <span>Thanh to√°n b·∫±ng v√≠ Zalopay</span>
                    </div>
                    <div class="payment-option" (click)="paymentMethod = 'napas'">
                        <span class="radio" [class.active]="paymentMethod === 'napas'"></span>
                        <span>Thanh to√°n b·∫±ng th·∫ª NAPAS</span>
                    </div>
                </div>
            </div>

            <!-- Right Column (Order Summary) -->
            <div class="checkout-right">
                <div class="checkout-summary">
                    <div class="coupon-input">
                        <input type="text" [(ngModel)]="couponCode" placeholder="√Åp d·ª•ng ∆∞u ƒë√£i ƒë·ªÉ ƒë∆∞·ª£c gi·∫£m gi√°" />
                    </div>

                    <div class="summary-row">
                        <span>T·ªïng ti·ªÅn</span>
                        <span class="summary-value">{{ cartTotal() | number:'1.0-0' }} ƒë</span>
                    </div>
                    <div class="summary-row">
                        <span>Gi·∫£m gi√° tr·ª±c ti·∫øp</span>
                        <span class="summary-value">-520.000 ƒë</span>
                    </div>
                    <div class="summary-row">
                        <span>Ph√≠ v·∫≠n chuy·ªÉn</span>
                        <span class="summary-value summary-free">Mi·ªÖn ph√≠</span>
                    </div>

                    <div class="summary-total-row">
                        <span class="summary-total-label">TH√ÄNH TI·ªÄN</span>
                        <span class="summary-total-value">{{ cartTotal() | number:'1.0-0' }} ƒë</span>
                    </div>

                    <button class="btn-checkout" (click)="submitOrder()" [disabled]="submitting()">
                        {{ submitting() ? 'ƒêang x·ª≠ l√Ω...' : 'HO√ÄN T·∫§T' }}
                    </button>

                    <p class="checkout-terms">
                        B·∫±ng vi·ªác ti·∫øn h√†nh ƒë·∫∑t mua h√†ng, b·∫°n ƒë·ªìng √Ω v·ªõi
                        <a href="#">ƒêi·ªÅu kho·∫£n d·ªãch v·ª•</a> c·ªßa AURAPC
                    </p>
                </div>
            </div>
        </div>

        @if (errorMessage()) {
        <div class="checkout-error">{{ errorMessage() }}</div>
        }
    </div>
</section>